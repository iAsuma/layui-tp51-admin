{extend name="public/base" /}
{block name="title"}微金积分{/block}
{block name="css"}
    <link rel="stylesheet" href="__THIRD__/ydui/css/ydui.css">
    <link rel="stylesheet" type="text/css" href="https://v1.91zlian.com/Public/newpage/css/style.css" />
    <link rel="stylesheet" type="text/css" href="https://v1.91zlian.com/Public/newpage/css/page.css" />
    <link rel="stylesheet" type="text/css" href="__CSS__/ding/score.css" />
{/block}
{block name="content"}
<div class="content-gray">
    <div class="layer-box1 bg-white">
        <h4>可用积分</h4>
        <h1>{$my.remain_points}</h1>
    </div>
    <div class="layer-box2 bg-white">
       <!-- <p>赚银币玩游戏</p> -->
       <a href="/wj/depoints/top" class="wawa"><img src="__IMAGE__/ding/top8.png" style="width: 100%;"></a>
    </div>
    <div class="item-title">积分记录</div>
    <div class="layer-box3 bg-white only">
        <p class="item-title-line"><em></em>
        汇总 
        <span class="right" style="padding-left: .5rem;"> 使用：<span class="b91">{$points.used*-1}</span></span>
        <span class="right"> 获得：<span class="f91">{$points.got}</span></span>
        </p>
        <ul class="money-history-list" id="c_list">
        
       </ul>
       <div class="clear"></div>
       <div id="c_scoll"></div>
    </div>
</div>
{/block}
{block name="footjs"}

    <script src="__THIRD__/ydui/js/ydui.flexible.js" type="text/javascript"></script>
    <script src="__THIRD__/ydui/js/ydui.js" type="text/javascript"></script>
    <script type="text/javascript">
        function list(data){
            var li_html = '';
            $.each(data, function(i, v){
                var type;
                if(v.type == 1){
                    type = '后台配额';
                }else if(v.type == 2){
                    type = '购物奖励';
                }else if(v.type == 3){
                    type = '购物扣除';
                }else if(v.type == 4){
                    type = '活动奖励';
                }else{
                    type = '其他';
                }

                if(v.remarks){
                    type += '：'+v.remarks;
                }

                var $class;
                if(v.points > 0){
                    $class = 'f90';
                }else{
                    $class = 'b92';
                }

                li_html += '<li>'+
                '<div class="left"><h4>'+type+'</h4><h5>'+v.createtime+'</h5></div>'+
                '<span class="right '+$class+'">'+v.points+'</span>'+
                '</li>';
            })

            return li_html
        }
    </script>
    <script type="text/javascript">
        var page = 1, pageSize = 10;

        $('#c_scoll').infiniteScroll({
            pageSize: pageSize,
            initLoad: true,
            doneTxt: '',
            loadListFn: function () {
                var def = $.Deferred();

                $.ajax({
                    type: "POST",
                    url: "{:url('myscorelist')}",
                    dataType: 'json',
                    data: { page: page, size: pageSize },
                    success: function (res) {
                        $('#c_list').append(list(res));

                        /* 获取数据，并插入页面后，调用resole，并传入当前获取的记录列表集合 */
                        def.resolve(res);

                        /* 页码自增1 */
                        ++page;
                    }
                });

                return def.promise();
            }
        });
    </script>
{/block}