{extend name="public/base" /}
{block name="title"}权限管理{/block}
{block name="content"}
<div class="layui-fluid">
<div class="layui-card">
  <div class="layui-form layui-card-header layuiadmin-card-header-auto">
    <div class="layui-form-item asuma-form-item">
      <div class="layui-inline">
        <label class="layui-form-label">文章ID</label>
        <div class="layui-input-inline">
          <input type="text" name="id" placeholder="请输入" autocomplete="off" class="layui-input">
        </div>
      </div>
      <div class="layui-inline">
        <label class="layui-form-label">作者</label>
        <div class="layui-input-inline">
          <input type="text" name="author" placeholder="请输入" autocomplete="off" class="layui-input">
        </div>
      </div>
      <div class="layui-inline">
        <label class="layui-form-label">标题</label>
        <div class="layui-input-inline">
          <input type="text" name="title" placeholder="请输入" autocomplete="off" class="layui-input">
        </div>
      </div>
      <div class="layui-inline">
        <label class="layui-form-label">文章标签</label>
        <div class="layui-input-inline">
          <select name="label">
            <option value="">请选择标签</option>
            <option value="0">美食</option>
            <option value="1">新闻</option>
            <option value="2">八卦</option>
            <option value="3">体育</option>
            <option value="4">音乐</option>
          </select>
        </div>
      </div>
      <div class="layui-inline">
        <button class="layui-btn layui-btn-asuma layuiadmin-btn-list" lay-submit lay-filter="LAY-app-contlist-search">
          <i class="layui-icon layui-icon-search layuiadmin-button-btn"></i>
        </button>
      </div>
    </div>
  </div>

  <div class="layui-card-body">
  	<div class="layui-tab-content">
	    <div style="padding-bottom: 10px;">
	      <button class="layui-btn layui-btn-asuma layuiadmin-btn-list" data-type="add">添加</button>
	    </div>
	    <table id="udzan-rule" lay-filter="udzan-rule"></table> 
	</div>
  </div>
</div>
</div>
{/block}
{block name="footjs"}
<script>
  layui.config({
    base: '__THIRD__/layuiadmin/' //静态资源所在路径
  }).extend({
    index: 'lib/index' //主入口模块
  }).use(['index', 'table'], function(){
    var table = layui.table
    ,form = layui.form;

    table.render({
      elem: '#udzan-rule'
      ,url: "{:url('permissionsList')}" //数据接口
      ,page: true //开启分页
      ,limits:[10,15,20]
      ,cols: [[ //表头
      	{field: 'title', title: '名称'}
      	,{field: 'type', title: '类型'}
        ,{field: 'name', title: '规则'}
        ,{field: 'sorted', title: '权重'}
        ,{field: 'status', title: '状态', templet: function(d){
          var status = ''
          switch(d.status){
            case 1:  status = '正常' ; break;
            case -2:  status = '冻结'; break;
            default: status = '异常'; break;
          }
          return status;
        }}
        ,{title: '操作'}
      ]]
    });
    
    //监听搜索
    form.on('submit(LAY-app-contlist-search)', function(data){
      var field = data.field;
      
      //执行重载
      table.reload('LAY-app-content-list', {
        where: field
      });
    });
    
    var $ = layui.$, active = {
      add: function(){
        layer.open({
          type: 2
          ,title: '添加文章'
          ,content: 'listform.html'
          ,maxmin: true
          ,area: ['550px', '550px']
          ,btn: ['确定', '取消']
          ,yes: function(index, layero){
            //点击确认触发 iframe 内容中的按钮提交
            var submit = layero.find('iframe').contents().find("#layuiadmin-app-form-submit");
            submit.click();
          }
        });
      }
    };

    $('.layui-btn.layuiadmin-btn-list').on('click', function(){
      var type = $(this).data('type');
      active[type] ? active[type].call(this) : '';
    });

  });
  </script>
{/block}